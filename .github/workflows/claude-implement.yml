name: Claude Code - Feature Implementation

on:
  issues:
    types: [labeled]

jobs:
  implement:
    if: github.event.label.name == 'claude'
    runs-on: ubuntu-latest
    timeout-minutes: 30

    permissions:
      contents: write
      pull-requests: write
      issues: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run Claude Code
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          claude_args: "--model claude-opus-4-6 --max-turns 100 --allowedTools Bash,Read,Write,Edit,Glob,Grep"
          show_full_output: true
          prompt: |
            Du bist ein erfahrener Entwickler fuer das FOF Stats Projekt.
            Lies CLAUDE.md im Repository-Root fuer alle Projekt-Konventionen.

            Wichtige Regeln:
            - Verwende `var` statt `const`/`let` im Frontend-JavaScript
            - Nutze immer `escapeHtml()` bei innerHTML mit User-Daten
            - Halte das DOS/Win95 Retro-Theme ein (Monospace, outset/inset Borders, gruener Akzent)
            - Alle UI-Texte auf Deutsch
            - Folge dem Feature-Modul-Pattern (IIFE CSS, Header-Kommentar, init-Funktion)
            - server.js ist eine einzelne grosse Datei - nicht aufteilen

            Implementiere das folgende Feature:
            Issue #${{ github.event.issue.number }}: ${{ github.event.issue.title }}
            ${{ github.event.issue.body }}

            Erstelle einen Branch, implementiere die Aenderungen, und erstelle einen PR mit:
            - Klarer Beschreibung der Aenderungen
            - Referenz zum Issue (#${{ github.event.issue.number }})
